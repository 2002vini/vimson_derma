{% extends 'temp_base.html' %}
{% load static %}

{% block title %}Careers Page{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/careers.css' %}">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
  href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Passion+One:wght@400;700;900&family=Roboto:wght@600&family=Source+Sans+3:ital,wght@0,200..900;1,200..900&display=swap"
  rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<style>
  .career-about{
      background-image: url('/static/images/career.png');
      display: flex;
      width: 100%;
      height:88vh;
      background-position: center;
      background-repeat: no-repeat;
      background-size: cover;
      align-items: center;
      justify-content: center;
  }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid career-about">
  <div class="overlay-text">
    <h1 class="heading">Career</h1>
    <p class="p-5">Would you like to be part of our company?</p>
  </div>
</div>

<!-- <div id="jobCarousel">
    <div class="container w-100">
        <h6 class="heading text-center mt-5 mb-5">Current Job Openings</h6>
        <div class="job-container">
            {% for job in jobs %}
            <a href="{% url 'careers_detail' job.id %}" class="text-decoration-none">
            <div class="card job-card text-center h-100">
                <div class="icon-box">
                  <i class="bi bi-person"></i>
                </div>
                <div class="job-description">
                <h5 class="mt-2 heading">{{job.title}}</h5>
                <p class="small text-muted">Experience: {{job.experience}} | No. of Openings: {{job.openings}}</p>
                </div>
                <button class="btn btn-primary apply-btn mt-2">Apply</button>
              </div>
            </a>
            {% endfor %}
    </div>
    </div>
   
</div> -->

<!-- Job Grid for Desktop (md and up) -->
<div class="container w-100 d-none d-md-block">
  <h6 class="heading text-center mt-5 mb-5">Current Job Openings</h6>
  <div class="job-container d-flex flex-wrap justify-content-center gap-4">
    {% for job in jobs %}
    <a href="{% url 'careers_detail' job.id %}" class="text-decoration-none">
      <div class="card job-card text-center h-100">
        <div class="icon-box">
          <i class="bi bi-person"></i>
        </div>
        <div class="job-description">
          <h5 class="mt-2 heading">{{ job.title }}</h5>
          <p class="small text-muted">Experience: {{ job.experience }} | No. of Openings: {{ job.openings }}</p>
        </div>
        <button class="btn btn-primary apply-btn mt-2">Apply</button>
      </div>
    </a>
    {% endfor %}
  </div>
</div>

<!-- Carousel for Mobile (sm only) -->
<div class="container d-md-none mt-5 mb-5">
  <h6 class="heading text-center mb-4">Current Job Openings</h6>
  <div id="jobCarouselMobile" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">
      {% for job in jobs %}
      <div class="carousel-item {% if forloop.first %}active{% endif %}">
        <div class="card job-card text-center mx-3">
          <div class="icon-box">
            <i class="bi bi-person"></i>
          </div>
          <div class="job-description">
            <h5 class="mt-2 heading">{{ job.title }}</h5>
            <p class="small text-muted">Experience: {{ job.experience }} | No. of Openings: {{ job.openings }}</p>
          </div>
          <a href="{% url 'careers_detail' job.id %}" class="btn btn-primary apply-btn mt-2">Apply</a>
        </div>
      </div>
      {% endfor %}
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#jobCarouselMobile" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#jobCarouselMobile" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
    </button>
  </div>
</div>

<!-- <section class="form-section">
    <div class="container">
        <h2>Apply For Job</h2>
        <form id="jobForm">
          <div class="form-grid">
            <input type="text" name="name" placeholder="Name" required>
            <input type="email" name="email" placeholder="Email" required>
            <input type="date" name="dob" placeholder="Date of Birth" required>            <input type="text" name="phone" placeholder="Phone Name" required>
            <select name="position" required>
              <option value="">Select Product</option>
              {% for position in positions %}
              <option value="{{position.position}}">{{position.position}}</option>
              {% endfor %}
            </select>
            <input type="file" id="resume" name="resume_csv" accept=".pdf,.doc,.docx" required>          </div>
          <button type="submit" class="submit-btn job-submit">Apply</button>
        </form>

    </div>
  </section> -->


<section class="form-section py-5">
  <div class="container">
    <h2 class="text-center mb-4 heading mt-3 mb-5">Apply For Job</h2>
    <form id="jobForm">
      <div class="row g-3">
        <div class="col-md-6">
          <input type="text" name="name" placeholder="Name" class="form-control" required>
        </div>
        <div class="col-md-6">
          <input type="email" name="email" placeholder="Email" class="form-control" required>
        </div>
        <div class="col-md-6">
          <input type="date" name="dob" placeholder="Date of Birth" class="form-control" required>
        </div>
        <div class="col-md-6">
          <input type="text" name="phone" placeholder="Phone Number" class="form-control" required>
        </div>
        <div class="col-12">
          <select name="position" class="form-select" required>
            <option value="">Select Position</option>
            {% for position in positions %}
            <option value="{{position.position}}">{{position.position}}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-12">
          <input type="file" id="resume" name="resume_csv" accept=".pdf,.doc,.docx" class="form-control" required
            placeholder="Upload Resume" data-bs-toggle="tooltip" title="Please upload your resume">
        </div>
        <div class="col-12 text-center mt-5">
          <button type="submit" class="submit-btn job-submit">Apply</button>
        </div>
      </div>
    </form>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const jobForm = document.getElementById('jobForm');
    function showToast(type, message) {
      Swal.fire({
        icon: type,
        title: message,
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        showCloseButton: true,
        timer: 5000,
        timerProgressBar: true,
        backdrop: false,
        customClass: {
          popup: 'no-blur-popup',
          title: 'custom-toast-title'
        }
      });
    }
    jobForm.addEventListener('submit', function (event) {
      event.preventDefault(); // Prevent the default form submission
      const resume = document.getElementById('resume');
      const file = resume.files[0];
      if (!file) {
        showToast('warning', 'Please upload your resume.');
        return;
      }
      const allowedExtensions = ['pdf', 'doc', 'docx'];
      const fileExtension = file.name.split('.').pop().toLowerCase();

      if (!allowedExtensions.includes(fileExtension)) {
        showToast('warning', 'Invalid resume format.Only PDF, DOC, or DOCX files are allowed.');
        return;
      }

      const formData = new FormData(jobForm);
      formData.append('resume', file); // Append the file to the FormData object
      console.log(formData.entries());
      fetch("{% url 'careers_apply' %}", {
        method: 'POST',
        headers: {
          'X-CSRFToken': '{{ csrf_token }}',
        },
        body: formData // Convert the object to a JSON string
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showToast('success', 'Application submitted successfully!');
            jobForm.reset();
          } else {
            showToast('error', 'Failed to submit application. details: ' + data.error);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showToast('error', 'An unexpected error occurred. Please try again.');
        });
    });
  });
</script>

{% endblock %}